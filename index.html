<!DOCTYPE html>
<html lang="pt-br">
<head>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#8b008b">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(() => console.log("App Pronto para Instala√ß√£o"))
      .catch(err => console.log("Erro no SW:", err));
  }
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Loterias Pro - Vers√£o 3.2</title>
    <style>
        :root {
            --cor-lotofacil: #8b008b;
            --cor-megasena: #209869;
            --bg-body: #f0f2f5;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-body); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        #modalCustom { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 20px; border-radius: 12px; text-align: center; max-width: 320px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .modal-btns { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .btn-modal { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; flex: 1; min-width: 80px; }
        .lf-theme .btn-sim { background: var(--cor-lotofacil); color: white; }
        .ms-theme .btn-sim { background: var(--cor-megasena); color: white; }
        .btn-nao { background: #eee; color: #333; }

        .menu-loterias { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 500px; }
        .btn-aba { flex: 1; padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; color: white; transition: 0.3s; opacity: 0.6; text-transform: uppercase; }
        .btn-aba.active { opacity: 1; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .aba-lotofacil { background-color: var(--cor-lotofacil); }
        .aba-megasena { background-color: var(--cor-megasena); }

        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 500px; width: 100%; display: none; }
        .container.active { display: block; }

        h2 { text-align: center; margin-bottom: 5px; }
        .busca-concurso { display: flex; gap: 5px; margin-bottom: 15px; justify-content: center; align-items: center; }
        .busca-concurso input { width: 100px; padding: 8px; border: 2px solid #ddd; border-radius: 5px; text-align: center; font-size: 16px; font-weight: bold; }
        .btn-nav { color: white; border: none; border-radius: 5px; width: 35px; height: 38px; cursor: pointer; font-weight: bold; font-size: 20px; }
        .btn-busca { background: #666; color: white; padding: 5px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; height: 38px; }

        .concurso-info { text-align: center; font-size: 0.95em; color: #333; font-weight: bold; margin-bottom: 10px; min-height: 20px; }
        .bolas-container { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .bola { width: 32px; height: 32px; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        
        .lf-theme .bola { background: var(--cor-lotofacil); }
        .lf-theme .bolas-container { background: #f8f0f8; }
        .ms-theme .bola { background: var(--cor-megasena); }
        .ms-theme .bolas-container { background: #f0f8f4; }
        
        .resumo-geral { border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 0.9em; text-align: center; line-height: 1.6; }
        .lf-theme .resumo-geral { background: #eef2ff; border: 1px solid #c7d2fe; color: #3730a3; }
        .ms-theme .resumo-geral { background: #e6fffa; border: 1px solid #b2f5ea; color: #234e52; }
        
        .caixa-acerto { background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(0, 0, 0, 0.03); border-radius: 6px; padding: 4px 12px; display: inline-block; margin: 4px 2px; }

        .add-jogo-section { background: #eee; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        .add-jogo-section input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        
        .btn { border: none; border-radius: 5px; cursor: pointer; font-weight: bold; padding: 10px; transition: 0.3s; width: 100%; }
        .btn-add-lf { background: var(--cor-lotofacil); color: white; }
        .btn-add-ms { background: var(--cor-megasena); color: white; }
        .btn-random { background: #555; color: white; font-size: 0.85em; margin-top: 5px; }
        .btn-limpar { background: #ff4444; color: white; margin-top: 10px; opacity: 0.7; }

        .secao-memoria { background: #f9f9f9; padding: 10px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 15px; }
        .grid-memoria { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 10px; }
        
        .btn-memoria { padding: 8px 2px; font-size: 11px; background: #fff; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-memoria:hover { background: #eee; }
        .btn-memoria.slot-active { 
            background: #444; 
            color: #fff; 
            border-color: #000;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .btn-guardar { width: 100%; font-size: 12px; padding: 8px; background: #444; color: white; border-radius: 5px; border: none; cursor: pointer; }

        .badge-vitorias { background: #ffd700; color: #000; font-size: 10px; padding: 2px 8px; border-radius: 10px; margin-left: 5px; border: 1px solid #daa520; font-weight: 900; }
        .badge-doze { background: #00c3ff; color: #fff; font-size: 10px; padding: 2px 8px; border-radius: 10px; margin-left: 5px; border: 1px solid #0096c7; font-weight: 900; }
        .badge-treze { background: #3730a3; color: #fff; font-size: 10px; padding: 2px 8px; border-radius: 10px; margin-left: 5px; border: 1px solid #1e1b4b; font-weight: 900; }
        .badge-dinheiro { background: #209869; color: #fff; font-size: 10px; padding: 2px 8px; border-radius: 10px; margin-left: 5px; font-weight: 900; }
        
        .painel-financeiro { margin-top: 15px; padding: 15px; border-radius: 10px; background: #fff; border: 1px solid #ddd; }
        .financeiro-item { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; }
        .financeiro-total { border-top: 1px solid #eee; margin-top: 10px; padding-top: 10px; font-weight: bold; font-size: 16px; }
        .lucro { color: #209869; }
        .prejuizo { color: #d93025; }

        .contagem-especial { margin-top: 10px; padding: 12px; background: #fffde7; border: 1px solid #fbc02d; border-radius: 10px; font-size: 14px; color: #5d4037; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .aviso-legal { margin-top: 15px; font-size: 11px; color: #777; text-align: center; line-height: 1.4; padding: 10px; border-top: 1px dashed #ccc; }

        .card-jogo { background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 10px; position: relative; }
        .premiado { background-color: #d4edda !important; border: 2px solid #28a745 !important; }
        
        .remove-btn { position: absolute; top: 5px; right: 5px; color: #999; cursor: pointer; border: none; background: none; font-weight: bold; }
        .num-acertado-lf { color: var(--cor-lotofacil); font-weight: bold; background: #fdf0fd; border-bottom: 2px solid var(--cor-lotofacil); }
        .num-acertado-ms { color: var(--cor-megasena); font-weight: bold; background: #f0fdf4; border-bottom: 2px solid var(--cor-megasena); }

        .progress-container { width: 100%; background-color: #ddd; border-radius: 10px; margin-top: 8px; display: none; height: 10px; overflow: hidden; }
        .progress-bar { height: 100%; background-color: #f39c12; width: 0%; transition: width 0.1s; }
    </style>
</head>
<body class="lf-theme">

    <div id="modalCustom">
        <div class="modal-content">
            <p id="modalMsg" style="font-weight: bold; color: #333;"></p>
            <div id="modalContainerBotoes" class="modal-btns">
                <button id="btnSim" class="btn-modal btn-sim">Confirmar</button>
                <button id="btnNao" class="btn-modal btn-nao">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="menu-loterias">
        <button class="btn-aba aba-lotofacil active" onclick="switchTab('lotofacil')">Lotof√°cil</button>
        <button class="btn-aba aba-megasena" onclick="switchTab('megasena')">Mega-Sena</button>
    </div>

    <div id="cont-lotofacil" class="container active lf-theme">
        <h2 style="color:var(--cor-lotofacil)">Lotof√°cil</h2>
        <div class="busca-concurso">
            <button class="btn-nav aba-lotofacil" onclick="navegarConcurso('lotofacil', -1)">-</button>
            <input type="number" id="numLF" placeholder="N¬∫">
            <button class="btn-nav aba-lotofacil" onclick="navegarConcurso('lotofacil', 1)">+</button>
            <button class="btn-busca" onclick="resetarEBuscar('lotofacil', document.getElementById('numLF').value)">Buscar</button>
        </div>
        <p id="infoLF" class="concurso-info">Carregando...</p>
        <div id="bolasLF" class="bolas-container"></div>
        <div id="resumoLF" class="resumo-geral">Aguardando...</div>
        
        <div class="add-jogo-section">
            <label><b>Cadastrar Jogo:</b></label>
            <input type="text" id="inputLF" placeholder="Digite de 15 a 20 n√∫meros">
            <button class="btn btn-add-lf" onclick="adicionarJogo('lotofacil')">Salvar Jogo na Lista</button>
            <button class="btn btn-random" onclick="gerarSurpresinha('lotofacil')">üé≤ Gerar Surpresinha (15 n√∫meros)</button>
        </div>

        <div class="secao-memoria">
            <button class="btn-guardar" onclick="prepararSalvamentoSlot('lotofacil')">üíæ Guardar Lista Atual em um Slot</button>
            <div class="grid-memoria">
                <button class="btn-memoria btn-memoria-lf-A" onclick="carregarSlot('lotofacil', 'A')">Jogo A</button>
                <button class="btn-memoria btn-memoria-lf-B" onclick="carregarSlot('lotofacil', 'B')">Jogo B</button>
                <button class="btn-memoria btn-memoria-lf-C" onclick="carregarSlot('lotofacil', 'C')">Jogo C</button>
                <button class="btn-memoria btn-memoria-lf-D" onclick="carregarSlot('lotofacil', 'D')">Jogo D</button>
                <button class="btn-memoria btn-memoria-lf-E" onclick="carregarSlot('lotofacil', 'E')">Jogo E</button>
            </div>
        </div>

        <div id="listaLF"></div>
        <button class="btn btn-limpar" onclick="confirmarLimpar('lotofacil')">Apagar Tudo</button>
        
        <div class="painel-financeiro" id="finLF">
            <div class="financeiro-item"><span>Total Investido:</span> <span id="valInvestidoLF">R$ 0,00</span></div>
            <div class="financeiro-item"><span>Total de Ganhos:</span> <span id="valGanhoLF">R$ 0,00</span></div>
            <div class="financeiro-total" id="statusLF">Saldo: R$ 0,00</div>
        </div>

        <div id="contagemEspecialLF" class="contagem-especial">
            <strong>üèÜ Pr√™mios de Elite Acumulados:</strong>
            <div id="count14LF">14 Acertos: 0x</div>
            <div id="count15LF">15 Acertos: 0x</div>
        </div>
        
        <div class="aviso-legal">
            ‚ö†Ô∏è <b>Aviso:</b> Este site √© uma ferramenta independente para facilitar a confer√™ncia de jogos. N√£o nos responsabilizamos por eventuais inconsist√™ncias nos resultados apresentados. Este site <b>n√£o garante pr√™mios</b> e n√£o possui v√≠nculo com a Caixa Econ√¥mica Federal. <b>Sempre confira seu bilhete oficial.</b>
        	<p><b>ATEN√á√ÉO - APOSTAR √â PARA MAIORES DE 18 ANOS</b></p>
	</div>
    </div>

    <div id="cont-megasena" class="container ms-theme">
        <h2 style="color:var(--cor-megasena)">Mega-Sena</h2>
        <div class="busca-concurso">
            <button class="btn-nav aba-megasena" onclick="navegarConcurso('megasena', -1)">-</button>
            <input type="number" id="numMS" placeholder="N¬∫">
            <button class="btn-nav aba-megasena" onclick="navegarConcurso('megasena', 1)">+</button>
            <button class="btn-busca" onclick="resetarEBuscar('megasena', document.getElementById('numMS').value)">Buscar</button>
        </div>
        <p id="infoMS" class="concurso-info">Carregando...</p>
        <div id="bolasMS" class="bolas-container"></div>
        <div id="resumoMS" class="resumo-geral">Aguardando...</div>
        
        <div class="add-jogo-section">
            <label><b>Cadastrar Jogo:</b></label>
            <input type="text" id="inputMS" placeholder="Digite de 6 a 20 n√∫meros">
            <button class="btn btn-add-ms" onclick="adicionarJogo('megasena')">Salvar Jogo na Lista</button>
            <button class="btn btn-random" onclick="gerarSurpresinha('megasena')">üé≤ Gerar Surpresinha (6 n√∫meros)</button>
        </div>

        <div class="secao-memoria">
            <button class="btn-guardar" onclick="prepararSalvamentoSlot('megasena')">üíæ Guardar Lista Atual em um Slot</button>
            <div class="grid-memoria">
                <button class="btn-memoria btn-memoria-ms-A" onclick="carregarSlot('megasena', 'A')">Jogo A</button>
                <button class="btn-memoria btn-memoria-ms-B" onclick="carregarSlot('megasena', 'B')">Jogo B</button>
                <button class="btn-memoria btn-memoria-ms-C" onclick="carregarSlot('megasena', 'C')">Jogo C</button>
                <button class="btn-memoria btn-memoria-ms-D" onclick="carregarSlot('megasena', 'D')">Jogo D</button>
                <button class="btn-memoria btn-memoria-ms-E" onclick="carregarSlot('megasena', 'E')">Jogo E</button>
            </div>
        </div>

        <div id="listaMS"></div>
        <button class="btn btn-limpar" onclick="confirmarLimpar('megasena')">Apagar Tudo</button>

        <div class="painel-financeiro" id="finMS">
            <div class="financeiro-item"><span>Total Investido:</span> <span id="valInvestidoMS">R$ 0,00</span></div>
            <div class="financeiro-item"><span>Total de Ganhos:</span> <span id="valGanhoMS">R$ 0,00</span></div>
            <div class="financeiro-total" id="statusMS">Saldo: R$ 0,00</div>
        </div>

        <div id="contagemEspecialMS" class="contagem-especial">
            <strong>üèÜ Pr√™mios de Elite Acumulados:</strong>
            <div id="count14MS">Quina: 0x</div>
            <div id="count15MS">Sena: 0x</div>
        </div>

        <div class="aviso-legal">
            ‚ö†Ô∏è <b>Aviso:</b> Este site √© uma ferramenta independente para facilitar a confer√™ncia de jogos. N√£o nos responsabilizamos por eventuais inconsist√™ncias nos resultados apresentados. Este site <b>n√£o garante pr√™mios</b> e n√£o possui v√≠nculo com a Caixa Econ√¥mica Federal. <b>Sempre confira seu bilhete oficial.</b>
        </div>
    </div>

<script>
    // --- L√ìGICA DE BITS (BITWISE) ---
    function dezenasParaMask(dezenas) {
        let mask = 0n;
        dezenas.forEach(n => { mask |= (1n << BigInt(n)); });
        return mask;
    }

    function conferirVeloz(maskJogo, maskSorteio) {
        let intersec = maskJogo & maskSorteio;
        let c = 0;
        while (intersec > 0n) {
            intersec &= (intersec - 1n);
            c++;
        }
        return c;
    }

    // --- L√ìGICA DE √ÅUDIO (ALERTA DE ELITE) ---
    function tocarAlertaElite() {
        try {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = context.createOscillator();
            const gainNode = context.createGain();
            oscillator.type = 'triangle'; 
            oscillator.frequency.setValueAtTime(880, context.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1320, context.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.1, context.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);
            oscillator.connect(gainNode);
            gainNode.connect(context.destination);
            oscillator.start();
            oscillator.stop(context.currentTime + 0.5);
        } catch (e) {}
    }

    let abortarConsultaMassa = false;

    function carregarJogos(tipo) {
        let storage = JSON.parse(localStorage.getItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS')) || [];
        return storage.map(j => {
            if (Array.isArray(j)) return { numeros: j, vitorias: 0, vitorias12: 0, vitorias13: 0, ganhoAcumulado: 0, concursosVistos: [] };
            if (!j.vitorias) j.vitorias = 0;
            if (!j.vitorias12) j.vitorias12 = 0;
            if (!j.vitorias13) j.vitorias13 = 0;
            if (!j.ganhoAcumulado) j.ganhoAcumulado = 0;
            if (!j.concursosVistos) j.concursosVistos = [];
            return j;
        });
    }

    let dados = {
        lotofacil: { ganhadores: [], meusJogos: carregarJogos('lotofacil'), api: 'lotofacil', min: 15, max: 20, max_bolas: 15, range: 25, custo: 3.50 },
        megasena: { ganhadores: [], meusJogos: carregarJogos('megasena'), api: 'megasena', min: 6, max: 20, max_bolas: 6, range: 60, custo: 6.00 }
    };

    let financeiroH = { 
        lotofacil: { investido: 0, ganho: 0, concursos_vistos: [] }, 
        megasena: { investido: 0, ganho: 0, concursos_vistos: [] } 
    };

    let contagemElite = {
        lotofacil: { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] },
        megasena: { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] }
    };

    function prepararSalvamentoSlot(tipo) {
        if (dados[tipo].meusJogos.length === 0) { exibirModal("N√£o h√° jogos na tela para salvar.", null, true); return; }
        const modal = document.getElementById('modalCustom');
        const msgEl = document.getElementById('modalMsg');
        const containerBotoes = document.getElementById('modalContainerBotoes');
        
        msgEl.innerText = "Em qual Slot deseja guardar?";
        containerBotoes.innerHTML = '';
        
        ['A', 'B', 'C', 'D', 'E'].forEach(slot => {
            const btn = document.createElement('button');
            const existeSalvo = localStorage.getItem(`slot_${tipo}_${slot}`);
            
            btn.className = 'btn-modal btn-sim';
            // Se houver jogo salvo, reduz a opacidade e adiciona um aviso visual
            if (existeSalvo) {
                btn.style.opacity = "0.6";
                btn.innerText = `Jogo ${slot} (Ocupado)`;
            } else {
                btn.innerText = `Jogo ${slot} (Vazio)`;
            }

            btn.onclick = () => { 
                if (existeSalvo) {
                    modal.style.display = 'none'; // Fecha o de slots
                    exibirModal(`O Slot ${slot} j√° tem jogos salvos. Tem certeza que deseja APAGAR os antigos e salvar a lista atual?`, () => {
                        executarSalvarSlot(tipo, slot);
                    }, false); // O callback ser√° disparado no bot√£o "Confirmar" do modal de aviso
                } else {
                    executarSalvarSlot(tipo, slot);
                    modal.style.display = 'none';
                }
            };
            containerBotoes.appendChild(btn);
        });
        
        const btnCanc = document.createElement('button');
        btnCanc.className = 'btn-modal btn-nao';
        btnCanc.innerText = 'Cancelar';
        btnCanc.onclick = () => { restaurarBotoesModal(); modal.style.display = 'none'; };
        containerBotoes.appendChild(btnCanc);
        modal.style.display = 'flex';
    }

    function executarSalvarSlot(tipo, slot) {
        const jogosParaSalvar = dados[tipo].meusJogos.map(j => ({ ...j, vitorias: 0, vitorias12: 0, vitorias13: 0, ganhoAcumulado: 0, concursosVistos: [] }));
        localStorage.setItem(`slot_${tipo}_${slot}`, JSON.stringify(jogosParaSalvar));
        exibirModal(`Jogos guardados com sucesso no Slot ${slot}!`, null, true);
    }

    function restaurarBotoesModal() {
        document.getElementById('modalContainerBotoes').innerHTML = `
            <button id="btnSim" class="btn-modal btn-sim">Confirmar</button>
            <button id="btnNao" class="btn-modal btn-nao">Cancelar</button>
        `;
    }

    function carregarSlot(tipo, slot) {
        const salvo = localStorage.getItem(`slot_${tipo}_${slot}`);
        if (salvo) {
            financeiroH[tipo] = { investido: 0, ganho: 0, concursos_vistos: [] };
            contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
            dados[tipo].meusJogos = JSON.parse(salvo);
            salvarNoLocalStorage(tipo);
            renderizar(tipo);
            const prefixo = tipo === 'lotofacil' ? 'lf' : 'ms';
            document.querySelectorAll(`.btn-memoria`).forEach(btn => { if(btn.className.includes(`btn-memoria-${prefixo}`)) btn.classList.remove('slot-active'); });
            const btnSel = document.querySelector(`.btn-memoria-${prefixo}-${slot}`);
            if(btnSel) btnSel.classList.add('slot-active');
            exibirModal(`Jogo ${slot} carregado para confer√™ncia!`, null, true);
        } else { exibirModal(`O Jogo ${slot} est√° vazio.`, null, true); }
    }

    function exibirModal(msg, callback, apenasAviso = false) {
        restaurarBotoesModal();
        const modal = document.getElementById('modalCustom');
        const msgEl = document.getElementById('modalMsg');
        const btnSim = document.getElementById('btnSim');
        const btnNao = document.getElementById('btnNao');
        msgEl.innerText = msg;
        modal.style.display = 'flex';
        btnNao.style.display = apenasAviso ? 'none' : 'block';
        btnSim.innerText = apenasAviso ? 'OK' : 'Confirmar';
        btnSim.onclick = () => { modal.style.display = 'none'; if (callback) callback(); };
        btnNao.onclick = () => { modal.style.display = 'none'; };
    }

    function switchTab(tipo) {
        document.querySelectorAll('.container, .btn-aba').forEach(el => el.classList.remove('active'));
        document.getElementById(`cont-${tipo}`).classList.add('active');
        document.querySelector(`.aba-${tipo}`).classList.add('active');
        document.body.className = `${tipo === 'lotofacil' ? 'lf' : 'ms'}-theme`;
    }

    async function buscar(tipo, concurso = 'latest') {
        const idInfo = tipo === 'lotofacil' ? 'infoLF' : 'infoMS';
        const idInput = tipo === 'lotofacil' ? 'numLF' : 'numMS';
        const idBolas = tipo === 'lotofacil' ? 'bolasLF' : 'bolasMS';
        const bolasEl = document.getElementById(idBolas);
        try {
            const termo = (concurso === '' || concurso === null) ? 'latest' : concurso;
            const response = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${dados[tipo].api}/${termo}`);
            if (!response.ok) throw new Error();
            const data = await response.json();
            dados[tipo].concursoAtual = data.concurso;
            document.getElementById(idInput).value = data.concurso;
            dados[tipo].ganhadores = data.dezenas.map(Number);
            document.getElementById(idInfo).innerHTML = `Concurso ${data.concurso} - Data: ${data.data}`;
            bolasEl.innerHTML = '';
            data.dezenas.forEach(num => { bolasEl.innerHTML += `<div class="bola">${num}</div>`; });
            renderizar(tipo);
            return data.concurso;
        } catch (e) {
            document.getElementById(idInfo).innerHTML = `<span style="color:#d93025">‚ö†Ô∏è CONCURSO N√ÉO ENCONTRADO OU N√ÉO SORTEADO</span>`;
            bolasEl.innerHTML = '';
            for(let i=0; i < dados[tipo].max_bolas; i++) bolasEl.innerHTML += `<div class="bola" style="background:#ccc; color:#666">- -</div>`;
            dados[tipo].ganhadores = [];
            renderizar(tipo);
            return null;
        }
    }

    function limparEstatisticasJogos(tipo) {
        dados[tipo].meusJogos = dados[tipo].meusJogos.map(j => {
            return { numeros: j.numeros, vitorias: 0, vitorias12: 0, vitorias13: 0, ganhoAcumulado: 0, concursosVistos: [] };
        });
        salvarNoLocalStorage(tipo);
    }

    async function conferirMassa(tipo) {
        const inputMassa = document.getElementById(`massa_${tipo}`);
        const btnMassa = document.getElementById(`btnMassa_${tipo}`);
        const progContainer = document.getElementById(`progContainer_${tipo}`);
        const progBar = document.getElementById(`progBar_${tipo}`);
        
        if (btnMassa.dataset.status === "rodando") {
            abortarConsultaMassa = true;
            return;
        }

        let inicio = parseInt(inputMassa.value);
        if (isNaN(inicio) || inicio <= 0) { exibirModal("Digite um concurso inicial v√°lido.", null, true); return; }
        
        const originalText = "üîç Conferir at√© o Fim";
        
        try {
            const respLatest = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${dados[tipo].api}/latest`);
            const dataLatest = await respLatest.json();
            const fim = dataLatest.concurso;

            if (inicio > fim) { exibirModal("Concurso inicial maior que o atual.", null, true); return; }

            const total = fim - inicio + 1;

            const iniciarLoop = async () => {
                abortarConsultaMassa = false;
                btnMassa.dataset.status = "rodando";
                btnMassa.style.backgroundColor = "#ff4444";
                progContainer.style.display = 'block';
                progBar.style.width = '0%';

                zerarFinanceiro(tipo);
                contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
                limparEstatisticasJogos(tipo);

                for (let c = inicio; c <= fim; c++) {
                    if (abortarConsultaMassa) break;

                    const percent = (((c - inicio + 1) / total) * 100).toFixed(0);
                    progBar.style.width = percent + '%';
                    btnMassa.innerText = `Parar - ‚è≥ Processando... (${percent}%)`;
                    
                    await buscar(tipo, c);
                }

                btnMassa.dataset.status = "parado";
                btnMassa.innerText = originalText;
                btnMassa.style.backgroundColor = "#f39c12";
                
                if (abortarConsultaMassa) {
                    exibirModal("Consulta interrompida pelo usu√°rio.", null, true);
                } else {
                    exibirModal(`Confer√™ncia finalizada do ${inicio} ao ${fim}!`, null, true);
                }
                setTimeout(() => { progContainer.style.display = 'none'; }, 2000);
            };

            if (total > 300) {
                exibirModal(`Voc√™ est√° prestes a consultar ${total} concursos. Deseja continuar?`, iniciarLoop);
            } else {
                iniciarLoop();
            }

        } catch (err) {
            exibirModal("Erro na confer√™ncia em massa.", null, true);
            btnMassa.dataset.status = "parado";
            btnMassa.innerText = originalText;
            btnMassa.style.backgroundColor = "#f39c12";
        }
    }

    function navegarConcurso(tipo, direcao) {
        const id = tipo === 'lotofacil' ? 'numLF' : 'numMS';
        let val = parseInt(document.getElementById(id).value);
        if(!isNaN(val)) buscar(tipo, val + direcao);
    }

    function gerarSurpresinha(tipo) {
        let numeros = [];
        while(numeros.length < dados[tipo].min) {
            let n = Math.floor(Math.random() * dados[tipo].range) + 1;
            if(!numeros.includes(n)) numeros.push(n);
        }
        numeros.sort((a,b) => a - b);
        dados[tipo].meusJogos.push({ numeros: numeros, vitorias: 0, vitorias12: 0, vitorias13: 0, ganhoAcumulado: 0, concursosVistos: [] });
        salvarNoLocalStorage(tipo);
        renderizar(tipo);
    }

    async function gerar50Jogos(tipo) {
        const btn = document.getElementById(`btn50_${tipo}`);
        const textoOriginal = btn.innerHTML;
        btn.innerHTML = "‚è≥ Gerando 50 Jogos...";
        btn.disabled = true;
        await new Promise(r => setTimeout(r, 200));
        for(let i=0; i<50; i++) { gerarSurpresinha(tipo); }
        btn.disabled = false;
        btn.innerHTML = textoOriginal;
        exibirModal("50 jogos gerados com sucesso!", null, true);
    }

    function adicionarJogo(tipo) {
        const input = document.getElementById(tipo === 'lotofacil' ? 'inputLF' : 'inputMS');
        let nums = input.value.split(/[\s,]+/).filter(n => n !== "").map(Number);
        const limiteMaximo = dados[tipo].range;
        if (nums.filter(n => n < 1 || n > limiteMaximo).length > 0) { exibirModal(`‚ö†Ô∏è N√∫meros fora do intervalo (01 a ${limiteMaximo})`, null, true); return; }
        let unicos = [...new Set(nums)];
        if (unicos.length !== nums.length) { exibirModal("‚ö†Ô∏è N√∫meros repetidos detectados!", null, true); return; }
        if (unicos.length < dados[tipo].min || unicos.length > dados[tipo].max) { exibirModal(`Digite entre ${dados[tipo].min} e ${dados[tipo].max} n√∫meros.`, null, true); return; }
        unicos.sort((a,b) => a-b);
        dados[tipo].meusJogos.push({ numeros: unicos, vitorias: 0, vitorias12: 0, vitorias13: 0, ganhoAcumulado: 0, concursosVistos: [] });
        salvarNoLocalStorage(tipo);
        input.value = '';
        renderizar(tipo);
    }

    function salvarNoLocalStorage(tipo) { localStorage.setItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS', JSON.stringify(dados[tipo].meusJogos)); }

    function confirmarRemover(tipo, index) { exibirModal("Deseja excluir este jogo?", () => { dados[tipo].meusJogos.splice(index, 1); salvarNoLocalStorage(tipo); renderizar(tipo); }); }

    function confirmarLimpar(tipo) { 
        exibirModal(`Deseja apagar todos os jogos de ${tipo}?`, () => { 
            dados[tipo].meusJogos = []; 
            localStorage.removeItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS'); 
            financeiroH[tipo] = { investido: 0, ganho: 0, concursos_vistos: [] }; 
            contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
            renderizar(tipo); 
        }); 
    }

    function renderizar(tipo) {
        const lista = document.getElementById(tipo === 'lotofacil' ? 'listaLF' : 'listaMS');
        const resumo = document.getElementById(tipo === 'lotofacil' ? 'resumoLF' : 'resumoMS');
        const classeAcerto = tipo === 'lotofacil' ? 'num-acertado-lf' : 'num-acertado-ms';
        if (dados[tipo].meusJogos.length === 0) { 
            lista.innerHTML = '<h3>Meus Jogos Salvos:</h3>'; 
            resumo.innerHTML = "Nenhum jogo salvo."; 
            atualizarPainelFinanceiro(tipo); 
            atualizarPainelElite(tipo);
            return; 
        }
        const concursoAtual = dados[tipo].concursoAtual;
        const maskSorteio = dezenasParaMask(dados[tipo].ganhadores);
        let totalInvestidoConcurso = dados[tipo].meusJogos.length * dados[tipo].custo;
        let totalGanhoConcurso = 0;
        let totalPremiados = 0;
        let stats = {};
        let acertoElite14 = false;
        let acertoElite15 = false;

        dados[tipo].meusJogos.forEach(jogo => {
            const maskJogo = dezenasParaMask(jogo.numeros);
            const acertos = conferirVeloz(maskJogo, maskSorteio);
            const minimoParaGanhar = (tipo === 'lotofacil' ? 11 : 4);
            const ganhou = acertos >= minimoParaGanhar && dados[tipo].ganhadores.length > 0;
            if (dados[tipo].ganhadores.length > 0) {
                if (tipo === 'lotofacil') { if (acertos === 14) acertoElite14 = true; if (acertos === 15) acertoElite15 = true; }
                else { if (acertos === 5) acertoElite14 = true; if (acertos === 6) acertoElite15 = true; }
            }
            let valorGanhoNeste = 0;
            if(ganhou && tipo === 'lotofacil') {
                if(acertos === 11) valorGanhoNeste = 7.00;
                if(acertos === 12) valorGanhoNeste = 14.00;
                if(acertos === 13) valorGanhoNeste = 35.00;
            }
            if (ganhou) {
                if (concursoAtual && !jogo.concursosVistos.includes(concursoAtual)) {
                    jogo.vitorias = (jogo.vitorias || 0) + 1;
                    if(tipo === 'lotofacil' && acertos === 12) jogo.vitorias12 = (jogo.vitorias12 || 0) + 1;
                    if(tipo === 'lotofacil' && acertos === 13) jogo.vitorias13 = (jogo.vitorias13 || 0) + 1;
                    jogo.ganhoAcumulado = (jogo.ganhoAcumulado || 0) + valorGanhoNeste;
                    jogo.concursosVistos.push(concursoAtual);
                }
                totalPremiados++;
                stats[acertos] = (stats[acertos] || 0) + 1;
                totalGanhoConcurso += valorGanhoNeste;
            }
            jogo.ultimoAcertoTemp = acertos; 
        });

        if (concursoAtual && !contagemElite[tipo].concursos_processados.includes(concursoAtual) && dados[tipo].ganhadores.length > 0) {
            if (acertoElite14) { contagemElite[tipo].c14++; contagemElite[tipo].lista14.push(concursoAtual); tocarAlertaElite(); }
            if (acertoElite15) { contagemElite[tipo].c15++; contagemElite[tipo].lista15.push(concursoAtual); tocarAlertaElite(); }
            contagemElite[tipo].concursos_processados.push(concursoAtual);
        }
        processarAcumulo(tipo, totalInvestidoConcurso, totalGanhoConcurso);
        salvarNoLocalStorage(tipo);
        dados[tipo].meusJogos.sort((a, b) => (b.ganhoAcumulado || 0) - (a.ganhoAcumulado || 0) || (b.vitorias || 0) - (a.vitorias || 0));

        lista.innerHTML = '<h3>Meus Jogos Salvos:</h3>';
        dados[tipo].meusJogos.forEach((jogo, idx) => {
            const acertos = jogo.ultimoAcertoTemp;
            const ganhou = acertos >= (tipo === 'lotofacil' ? 11 : 4) && dados[tipo].ganhadores.length > 0;
            const htmlJogo = jogo.numeros.map(n => (dados[tipo].ganhadores.includes(n)) ? `<span class="${classeAcerto}">${n.toString().padStart(2, '0')}</span>` : n.toString().padStart(2, '0')).join(' ');
            lista.innerHTML += `
                <div class="card-jogo ${ganhou ? 'premiado' : ''}"> 
                    <button class="remove-btn" onclick="confirmarRemover('${tipo}', ${idx})">X</button> 
                    <div style="font-family: monospace; font-size: 1.1em; margin-bottom:5px;">${htmlJogo}</div> 
                    <small><b>${acertos} ACERTOS</b></small> 
                    ${jogo.vitorias > 0 ? `<span class="badge-vitorias">üèÜ ${jogo.vitorias}x Premiado</span>` : ''} 
                    ${tipo === 'lotofacil' && jogo.vitorias12 > 0 ? `<span class="badge-doze">‚ú® 12 pts: ${jogo.vitorias12}x</span>` : ''}
                    ${tipo === 'lotofacil' && jogo.vitorias13 > 0 ? `<span class="badge-treze">üî• 13 pts: ${jogo.vitorias13}x</span>` : ''} 
                    ${jogo.ganhoAcumulado > 0 ? `<span class="badge-dinheiro">üí∞ Total: R$ ${jogo.ganhoAcumulado.toFixed(2)}</span>` : ''}
                </div>`;
        });
        if (dados[tipo].ganhadores.length > 0) {
            if (totalPremiados > 0) {
                let resumoHtml = `<strong>üéâ PARAB√âNS! ${totalPremiados} jogo(s) premiado(s)!</strong><br>`;
                [15,14,13,12,11,6,5,4].forEach(f => { if (stats[f]) resumoHtml += `<div class="caixa-acerto">${stats[f]} jogo(s) de <b>${f} acertos</b></div><br>`; });
                resumo.innerHTML = resumoHtml;
            } else resumo.innerHTML = "Nenhum jogo premiado neste concurso.";
        } else resumo.innerHTML = "Aguardando resultado...";
        atualizarPainelFinanceiro(tipo); atualizarPainelElite(tipo);
    }

    function atualizarPainelElite(tipo) {
        const sufixo = tipo === 'lotofacil' ? 'LF' : 'MS';
        const label14 = tipo === 'lotofacil' ? '14 Acertos' : 'Quina';
        const label15 = tipo === 'lotofacil' ? '15 Acertos' : 'Sena';
        const l14 = contagemElite[tipo].lista14.length > 0 ? " - " + contagemElite[tipo].lista14.join(", ") : "";
        const l15 = contagemElite[tipo].lista15.length > 0 ? " - " + contagemElite[tipo].lista15.join(", ") : "";
        document.getElementById(`count14${sufixo}`).innerHTML = `${label14}: <b>${contagemElite[tipo].c14}x</b> <small style="color:#666">${l14}</small>`;
        document.getElementById(`count15${sufixo}`).innerHTML = `${label15}: <b>${contagemElite[tipo].c15}x</b> <small style="color:#666">${l15}</small>`;
    }

    function processarAcumulo(tipo, custo, premio) {
        const conc = dados[tipo].concursoAtual;
        if (conc && !financeiroH[tipo].concursos_vistos.includes(conc) && dados[tipo].ganhadores.length > 0) {
            financeiroH[tipo].investido += custo; financeiroH[tipo].ganho += premio; financeiroH[tipo].concursos_vistos.push(conc);
        }
    }

    function atualizarPainelFinanceiro(tipo) {
        const sufixo = tipo === 'lotofacil' ? 'LF' : 'MS';
        const saldo = financeiroH[tipo].ganho - financeiroH[tipo].investido;
        document.getElementById(`valInvestido${sufixo}`).innerText = `R$ ${financeiroH[tipo].investido.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
        document.getElementById(`valGanho${sufixo}`).innerText = `R$ ${financeiroH[tipo].ganho.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
        const el = document.getElementById(`status${sufixo}`);
        el.innerText = `Saldo: R$ ${saldo.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
        el.className = 'financeiro-total ' + (saldo > 0 ? 'lucro' : (saldo < 0 ? 'prejuizo' : ''));
    }

    function zerarFinanceiro(tipo) { financeiroH[tipo] = { investido: 0, ganho: 0, concursos_vistos: [] }; atualizarPainelFinanceiro(tipo); }
    function resetarEBuscar(tipo, conc) { zerarFinanceiro(tipo); contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] }; limparEstatisticasJogos(tipo); buscar(tipo, conc); }

    function unificarNovosBotoes() {
        ['lotofacil', 'megasena'].forEach(tipo => {
            const container = document.querySelector(`#cont-${tipo} .add-jogo-section`);
            if (container) {
                const hr = document.createElement('hr'); hr.style.margin = "10px 0"; hr.style.opacity = "0.3"; container.appendChild(hr);
                const btn50 = document.createElement('button');
                btn50.id = `btn50_${tipo}`; btn50.className = "btn btn-random"; btn50.style.backgroundColor = "#2c3e50";
                btn50.innerHTML = "üé∞ Gerar 50 Jogos Surpresinha"; btn50.onclick = () => { gerar50Jogos(tipo); };
                container.appendChild(btn50);
                const divMassa = document.createElement('div');
                divMassa.innerHTML = `
                    <label style="font-size:12px"><b>Confer√™ncia em Massa:</b></label>
                    <div style="display:flex; gap:5px; margin-top:5px">
                        <input type="number" id="massa_${tipo}" placeholder="Conc. Inicial" style="flex:1; padding:8px; font-size:12px">
                        <button id="btnMassa_${tipo}" class="btn" data-status="parado" style="flex:1; background:#f39c12; color:white; font-size:12px" onclick="conferirMassa('${tipo}')">üîç Conferir at√© o Fim</button>
                    </div>
                    <div id="progContainer_${tipo}" class="progress-container"><div id="progBar_${tipo}" class="progress-bar"></div></div>
                `;
                container.appendChild(divMassa);
            }
        });
    }

    window.onload = () => { 
        zerarFinanceiro('lotofacil'); zerarFinanceiro('megasena');
        contagemElite['lotofacil'] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
        contagemElite['megasena'] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
        limparEstatisticasJogos('lotofacil'); limparEstatisticasJogos('megasena');
        buscar('lotofacil', 'latest'); buscar('megasena', 'latest'); unificarNovosBotoes(); 
    };
</script>
</body>
</html>